(function(e,k,d){var h=k.registerModule("forms","0.1.0");var l={url:"module/upload",uploads:"#uploads",onupload:function(m){}};var i=[];var c=false;h.uploader=function(n,o){var m=e.extend(l,o);if(!c){j(m)}e(n).each(function(){var p=e(this);p.append(e("<form>"));p.on("dragenter",function(q){q.stopPropagation();q.preventDefault();p.addClass("active")}).on("dragover",a).on("drop",function(q){q.stopPropagation();q.preventDefault();g(p,m,q.originalEvent.dataTransfer.files);p.removeClass("active")});i[i.length]=p})};var j=function(m){e(document).on("gradenter",a).on("dragover",function(o){a(o);for(var n=0;n<i.length;n++){i[n].removeClass("active")}}).on("drop",a);c=true};var a=function(m){m.stopPropagation();m.preventDefault()};var g=function(r,m,o){for(var q=0;q<o.length;q++){var n=new FormData();n.append("file",o[q]);var p=new f(r,m.uploads);p.setFileNameSize(o[q].name,o[q].size);b(n,m.url,p,m.onupload)}};var f=function(m,n){this.statusbar=e('<div class="statusbar"/>');this.filename=e('<div class="filename"/>').appendTo(this.statusbar);this.size=e('<div class="size"/>').appendTo(this.statusbar);this.progressBar=e('<div class="progressbar"><div></div></div>').appendTo(this.statusbar);this.abort=e('<div class="abort"/>').appendTo(this.statusbar);if(e(n)[0]!==d){e(n).append(this.statusbar)}this.setFileNameSize=function(o,p){var r="";var q=p/1024;if(parseInt(q)>1024){var s=q/1024;r=s.toFixed(2)+" MB"}else{r=q.toFixed(2)+" KB"}this.filename.html(o);this.size.html(r)};this.progress=function(o){this.progressBar.find("div").html(o+"%").css({width:o+"%"});if(parseInt(o)>=100){this.abort.hide()}};this.setAbort=function(o){var p=this.statusBar;this.abort.click(function(){o.abort();p.hide()})}};var b=function(m,o,n,q){var p=e.ajax({url:o,type:"POST",dataType:"json",contentType:false,processData:false,cache:false,data:m,progress:function(s){var r=Math.round((s.loaded/s.total)*100);n.progress(r)},success:function(r){n.progress(100);q(r.id)}});n.setAbort(p)}}(jQuery,WholeAuth));