(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{a.storage=b()}}(_,function(){var n="0.1.2",f=false,g=0,k=false,j=null;function i(){window.localStorage.setItem("__simpleStorageInitTest","tmpval");window.localStorage.removeItem("__simpleStorageInitTest");a();m();h();if("addEventListener" in window){window.addEventListener("pageshow",function(o){if(o.persisted){c()}},false)}k=true}function h(){if("addEventListener" in window){window.addEventListener("storage",c,false)}else{document.attachEvent("onstorage",c)}}function c(){try{a()}catch(o){k=false;return}m()}function a(){var p=localStorage.wholeauthStorage;try{f=JSON.parse(p)}catch(o){f={}}g=localStorage.wholeauthStorage?String(localStorage.wholeauthStorage).length:0}function d(){try{localStorage.wholeauthStorage=JSON.stringify(f);g=localStorage.wholeauthStorage?String(localStorage.wholeauthStorage).length:0}catch(o){return o}return true}function m(){var u,r,o,q,s,t=Infinity,p=0;clearTimeout(j);if(!f||!f.__simpleStorage_meta||!f.__simpleStorage_meta.TTL){return}u=+new Date();s=f.__simpleStorage_meta.TTL.keys||[];q=f.__simpleStorage_meta.TTL.expire||{};for(r=0,o=s.length;r<o;r++){if(q[s[r]]<=u){p++;delete f[s[r]];delete q[s[r]]}else{if(q[s[r]]<t){t=q[s[r]]}break}}if(t!=Infinity){j=setTimeout(m,Math.min(t-u,2147483647))}if(p){s.splice(0,p);b();d()}}function e(r,p){var t=+new Date(),q,o,s=false;p=Number(p)||0;if(p!==0){if(f.hasOwnProperty(r)){if(!f.__simpleStorage_meta){f.__simpleStorage_meta={}}if(!f.__simpleStorage_meta.TTL){f.__simpleStorage_meta.TTL={expire:{},keys:[]}}f.__simpleStorage_meta.TTL.expire[r]=t+p;if(f.__simpleStorage_meta.TTL.expire.hasOwnProperty(r)){for(q=0,o=f.__simpleStorage_meta.TTL.keys.length;q<o;q++){if(f.__simpleStorage_meta.TTL.keys[q]==r){f.__simpleStorage_meta.TTL.keys.splice(q)}}}for(q=0,o=f.__simpleStorage_meta.TTL.keys.length;q<o;q++){if(f.__simpleStorage_meta.TTL.expire[f.__simpleStorage_meta.TTL.keys[q]]>t+p){f.__simpleStorage_meta.TTL.keys.splice(q,0,r)}}if(!s){f.__simpleStorage_meta.TTL.keys.push(r)}}else{return false}}else{if(f&&f.__simpleStorage_meta&&f.__simpleStorage_meta.TTL){if(f.__simpleStorage_meta.TTL.expire.hasOwnProperty(r)){delete f.__simpleStorage_meta.TTL.expire[r];for(q=0,o=f.__simpleStorage_meta.TTL.keys.length;q<o;q++){if(f.__simpleStorage_meta.TTL.keys[q]==r){f.__simpleStorage_meta.TTL.keys.splice(q,1);break}}}b()}}clearTimeout(j);if(f&&f.__simpleStorage_meta&&f.__simpleStorage_meta.TTL&&f.__simpleStorage_meta.TTL.keys.length){j=setTimeout(m,Math.min(Math.max(f.__simpleStorage_meta.TTL.expire[f.__simpleStorage_meta.TTL.keys[0]]-t,0),2147483647))}return true}function b(){var o=false,q=false,p;if(!f||!f.__simpleStorage_meta){return o}if(f.__simpleStorage_meta.TTL&&!f.__simpleStorage_meta.TTL.keys.length){delete f.__simpleStorage_meta.TTL;o=true}for(p in f.__simpleStorage_meta){if(f.__simpleStorage_meta.hasOwnProperty(p)){q=true;break}}if(!q){delete f.__simpleStorage_meta;o=true}return o}try{i()}catch(l){}return{version:n,canUse:function(){return !!k},set:function(p,r,o){if(p=="__simpleStorage_meta"){return false}if(!f){return false}if(typeof r=="undefined"){return this.deleteKey(p)}o=o||{};try{r=JSON.parse(JSON.stringify(r))}catch(q){return q}f[p]=r;e(p,o.TTL||0);return d()},get:function(o){if(!f){return false}if(f.hasOwnProperty(o)&&o!="__simpleStorage_meta"){if(this.getTTL(o)){return f[o]}}},deleteKey:function(o){if(!f){return false}if(o in f){delete f[o];e(o,0);return d()}return false},setTTL:function(p,o){if(!f){return false}e(p,o);return d()},getTTL:function(p){var o;if(!f){return false}if(f.hasOwnProperty(p)){if(f.__simpleStorage_meta&&f.__simpleStorage_meta.TTL&&f.__simpleStorage_meta.TTL.expire&&f.__simpleStorage_meta.TTL.expire.hasOwnProperty(p)){o=Math.max(f.__simpleStorage_meta.TTL.expire[p]-(+new Date())||0,0);return o||false}else{return Infinity}}return false},flush:function(){if(!f){return false}f={};try{localStorage.removeItem("wholeauthStorage");return true}catch(o){return o}},index:function(){if(!f){return false}var o=[],p;for(p in f){if(f.hasOwnProperty(p)&&p!="__simpleStorage_meta"){o.push(p)}}return o},storageSize:function(){return g}}}));